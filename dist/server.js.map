{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/graphs/application/resolvers.js","webpack:///./src/graphs/delay/resolvers.js","webpack:///./src/graphs/game/resolvers.js","webpack:///./src/graphs/resolvers.js","webpack:///./src/index.js","webpack:///./src/server.js","webpack:///./src/utils/firebase.js","webpack:///external \"apollo-server\"","webpack:///external \"babel-runtime/core-js/object/keys\"","webpack:///external \"babel-runtime/core-js/promise\"","webpack:///external \"babel-runtime/helpers/asyncToGenerator\"","webpack:///external \"babel-runtime/helpers/classCallCheck\"","webpack:///external \"babel-runtime/helpers/createClass\"","webpack:///external \"babel-runtime/helpers/extends\"","webpack:///external \"babel-runtime/regenerator\"","webpack:///external \"firebase\"","webpack:///external \"firebase-admin\"","webpack:///external \"firebase/database\"","webpack:///external \"graphql-import\"","webpack:///external \"lodash\""],"names":["Query","summitUpload","obj","ctx","input","online","refError","ApolloError","delay","arg","asyncRef","ref","docRef","child","once","then","snap","val","Mutation","setDelay","set","addDelay","callback","delayRef","res","rej","setTimeout","catch","application","game","id","email","snapVal","keys","filter","k","actionIds","gameId","Game","actions","gameRef","map","key","optimistic","clearGame","deviceId","db","firestore","FieldValue","delete","result","addGameAction","value","type","timeStamp","push","newRef","typeDefs","importSchema","PORT","process","env","server","ApolloServer","context","Context","req","resolvers","_","reduce","prev","next","merge","formatError","err","message","startsWith","AuthenticationError","replace","playground","listen","port","url","console","log","request","headers","connection","user","strippedId","deviceid","validate","exists","isValue","name","setRef","firebase","initializeApp","settings","database"],"mappings":"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","file":"server.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.js\");\n","export default {\n  Query: {\n    summitUpload: async (obj, { input }, ctx) => {\n      return {\n        online: true\n      };\n    }\n  }\n};\n","import { ApolloError } from \"apollo-server\";\n\nconst refError = new ApolloError(\"no user/email attached\", \"EMAIL_ERROR\");\n\nexport default {\n  Query: {\n    delay: async (obj, arg, { asyncRef }) => {\n      const ref = await asyncRef;\n      if (!ref) return refError;\n      let docRef = ref.child(\"delay\");\n      return docRef.once(\"value\").then(snap => snap.val());\n    }\n  },\n  Mutation: {\n    setDelay: async (obj, { delay }, { asyncRef }) => {\n      const ref = await asyncRef;\n      if (!ref) return refError;\n      let docRef = ref.child(\"delay\");\n      docRef.set(delay);\n      return delay;\n    }\n  }\n};\n","import { ApolloError } from \"apollo-server\";\nimport db from \"../../utils/firebase\";\nimport { firestore } from \"firebase-admin\";\n\nconst addDelay = async (ref, callback) => {\n  const delayRef = ref.child(\"delay\");\n  const delay = await delayRef.once(\"value\").then(snap => snap.val());\n  return new Promise((res, rej) => {\n    setTimeout(\n      () =>\n        callback()\n          .then(res)\n          .catch(rej),\n      delay * 1000\n    );\n  });\n};\n\nconst refError = new ApolloError(\"no user/email attached\", \"EMAIL_ERROR\");\n\nexport default {\n  Query: {\n    application: async (obj, { input }, ctx) => {\n      return {\n        online: true\n      };\n    },\n    game: async (obj, { id }, { asyncRef, email }) => {\n      const ref = await asyncRef;\n      if (!ref) return refError;\n      const snap = await ref.once(\"value\");\n      const snapVal = snap.val();\n      const keys = Object.keys(snapVal).filter(k => k !== \"name\");\n      return { delay: snapVal.delay, actionIds: keys, gameId: email };\n    }\n  },\n  Game: {\n    id: obj => obj.gameId,\n    actions: async (obj, arg, { asyncRef }) => {\n      const ref = await asyncRef;\n\n      if (!ref) return refError;\n      const gameRef = ref.child(\"actions\");\n      return gameRef.once(\"value\").then(snap => {\n        const snapVal = snap.val();\n        return Object.keys(snapVal).map(key => ({\n          id: key,\n          optimistic: false,\n          ...snapVal[key]\n        }));\n      });\n    }\n  },\n  Mutation: {\n    clearGame: async (obj, { deviceId }, ctx) => {\n      if (!deviceId) return false;\n      const ref = db.ref(deviceId);\n      const result = await ref.set(firestore.FieldValue.delete());\n      return !!result;\n    },\n    addGameAction: async (obj, { input }, { asyncRef }) => {\n      const ref = await asyncRef;\n      if (!ref) return refError;\n      const { value, type, gameId, timeStamp } = input;\n      let docRef = ref.child(\"actions\");\n      return addDelay(ref, async () => {\n        const newRef = await docRef.push({\n          type,\n          value,\n          timeStamp\n        });\n\n        const snap = await docRef.once(\"value\");\n        const actions = snap.val();\n        return Object.keys(actions).map(k => ({ id: k, ...actions[k] }));\n      });\n    }\n  }\n};\n","export { default as game } from \"./game/resolvers\";\nexport { default as application } from \"./application/resolvers\";\nexport { default as delay } from \"./delay/resolvers\";\n","import server from './server'","import { importSchema } from \"graphql-import\";\nimport { ApolloServer, AuthenticationError } from \"apollo-server\";\nimport _ from \"lodash\";\nimport db from \"./utils/firebase\";\n\nimport * as resolvers from \"./graphs/resolvers\";\n\nconst typeDefs = importSchema(\"./src/graphs/schema.graphql\");\n\n// not required but can be useful if you run multiple servers.\nconst PORT = process.env.PORT || 2999;\n\nconst server = new ApolloServer({\n  typeDefs,\n  context: req => new Context(req),\n  resolvers: _.reduce(resolvers, (prev, next) => _.merge(prev, next)),\n  formatError: err => {\n    if (err.message.startsWith(\"Context creation failed: \")) {\n      return new AuthenticationError(\n        err.message.replace(\"Context creation failed: \", \"\")\n      );\n    }\n    return err;\n  },\n  playground: true\n});\n\n// Start accepting connections.\nserver.listen({ port: PORT }).then(({ url }) => {\n  console.log(`🚀 Apollo server running on port ${url}`);\n});\n\nclass Context {\n  constructor(request) {\n    const headers = request.req\n      ? request.req.headers\n      : request.connection.context;\n    this.user = headers && headers.user;\n    this.request = request.req;\n\n    this.strippedId =\n      headers &&\n      headers.deviceid &&\n      this.validate(headers).replace(/[.\\#\\$]/g, \"-\");\n  }\n\n  get asyncRef() {\n    if (this.strippedId && this.user) return this.setRef(this.strippedId);\n  }\n\n  validate(headers) {\n    if (!headers || !headers.deviceid) {\n      return \"\";\n    }\n    return headers.deviceid;\n  }\n\n  async setRef(deviceId) {\n    const isValue = await db\n      .ref()\n      .child(deviceId)\n      .once(\"value\")\n      .then(snap => snap.exists());\n    if (!isValue) {\n      await db\n        .ref()\n        .child(deviceId)\n        .set({ name: this.user, delay: 0 });\n    }\n    return db.ref(deviceId);\n  }\n}\n","import admin from \"firebase-admin\";\nimport settings from \"../../settings.json\";\nimport \"firebase/database\";\nimport firebase from \"firebase\";\n\nfirebase.initializeApp(settings.firebase);\n\nexport default firebase.database();\n","module.exports = require(\"apollo-server\");","module.exports = require(\"babel-runtime/core-js/object/keys\");","module.exports = require(\"babel-runtime/core-js/promise\");","module.exports = require(\"babel-runtime/helpers/asyncToGenerator\");","module.exports = require(\"babel-runtime/helpers/classCallCheck\");","module.exports = require(\"babel-runtime/helpers/createClass\");","module.exports = require(\"babel-runtime/helpers/extends\");","module.exports = require(\"babel-runtime/regenerator\");","module.exports = require(\"firebase\");","module.exports = require(\"firebase-admin\");","module.exports = require(\"firebase/database\");","module.exports = require(\"graphql-import\");","module.exports = require(\"lodash\");"],"sourceRoot":""}