{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/graphs/application/resolvers.js","webpack:///./src/graphs/delay/resolvers.js","webpack:///./src/graphs/game/resolvers.js","webpack:///./src/graphs/resolvers.js","webpack:///./src/index.js","webpack:///./src/server.js","webpack:///./src/utils/firebase.js","webpack:///external \"apollo-server\"","webpack:///external \"babel-runtime/core-js/object/keys\"","webpack:///external \"babel-runtime/core-js/promise\"","webpack:///external \"babel-runtime/helpers/asyncToGenerator\"","webpack:///external \"babel-runtime/helpers/classCallCheck\"","webpack:///external \"babel-runtime/helpers/createClass\"","webpack:///external \"babel-runtime/helpers/extends\"","webpack:///external \"babel-runtime/regenerator\"","webpack:///external \"firebase\"","webpack:///external \"firebase-admin\"","webpack:///external \"firebase/database\"","webpack:///external \"graphql-import\"","webpack:///external \"lodash\""],"names":["Query","summitUpload","obj","ctx","input","online","delay","arg","ref","docRef","child","once","then","snap","val","Mutation","setDelay","set","addDelay","callback","delayRef","res","rej","setTimeout","catch","refError","ApolloError","application","game","id","email","snapVal","keys","filter","k","actionIds","gameId","Game","actions","gameRef","map","key","optimistic","addGameAction","value","type","timeStamp","push","newRef","typeDefs","importSchema","PORT","process","env","server","ApolloServer","context","Context","req","resolvers","_","reduce","prev","next","merge","formatError","err","message","startsWith","AuthenticationError","replace","playground","listen","port","url","console","log","request","headers","connection","strippedEmail","validate","db","re","test","String","toLowerCase","firebase","initializeApp","settings","database"],"mappings":"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","file":"server.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.js\");\n","export default {\n  Query: {\n    summitUpload: async (obj, { input }, ctx) => {\n      return {\n        online: true\n      };\n    }\n  }\n};\n","import db from \"../../utils/firebase\";\n\nexport default {\n  Query: {\n    delay: (obj, arg, { ref }) => {\n      let docRef = ref.child(\"delay\");\n      return docRef.once(\"value\").then(snap => snap.val());\n    }\n  },\n  Mutation: {\n    setDelay: (obj, { delay }, { ref }) => {\n      let docRef = ref.child(\"delay\");\n      docRef.set(delay);\n      return delay;\n    }\n  }\n};\n","import { ApolloError } from \"apollo-server\";\nconst addDelay = async (ref, callback) => {\n  const delayRef = ref.child(\"delay\");\n  const delay = await delayRef.once(\"value\").then(snap => snap.val());\n  return new Promise((res, rej) => {\n    setTimeout(\n      () =>\n        callback()\n          .then(res)\n          .catch(rej),\n      delay * 1000\n    );\n  });\n};\n\nconst refError = new ApolloError(\"no user/email attached\", \"EMAIL_ERROR\");\n\nexport default {\n  Query: {\n    application: async (obj, { input }, ctx) => {\n      return {\n        online: true\n      };\n    },\n    game: async (obj, { id }, { ref, email }) => {\n      if (!ref) return refError;\n      const snap = await ref.once(\"value\");\n      const snapVal = snap.val();\n      const keys = Object.keys(snapVal).filter(k => k !== \"name\");\n      return { delay: snapVal.delay, actionIds: keys, gameId: email };\n    }\n  },\n  Game: {\n    id: obj => obj.gameId,\n    actions: (obj, arg, { ref }) => {\n      if (!ref) return refError;\n      const gameRef = ref.child(\"actions\");\n      return gameRef.once(\"value\").then(snap => {\n        const snapVal = snap.val();\n        return Object.keys(snapVal).map(key => ({\n          id: key,\n          optimistic: false,\n          ...snapVal[key]\n        }));\n      });\n    }\n  },\n  Mutation: {\n    addGameAction: (obj, { input }, { ref }) => {\n      if (!ref) return refError;\n      const { value, type, gameId, timeStamp } = input;\n      let docRef = ref.child(\"actions\");\n      return addDelay(ref, async () => {\n        const newRef = await docRef.push({\n          type,\n          value,\n          timeStamp\n        });\n\n        const snap = await docRef.once(\"value\");\n        const actions = snap.val();\n        return Object.keys(actions).map(k => ({ id: k, ...actions[k] }));\n      });\n    }\n  }\n};\n","export { default as game } from \"./game/resolvers\";\nexport { default as application } from \"./application/resolvers\";\nexport { default as delay } from \"./delay/resolvers\";\n","import server from './server'","import { importSchema } from \"graphql-import\";\nimport { ApolloServer, AuthenticationError } from \"apollo-server\";\nimport _ from \"lodash\";\nimport db from \"./utils/firebase\";\n\nimport * as resolvers from \"./graphs/resolvers\";\n\nconst typeDefs = importSchema(\"./src/graphs/schema.graphql\");\n\n// not required but can be useful if you run multiple servers.\nconst PORT = process.env.PORT || 2999;\n\nconst server = new ApolloServer({\n  typeDefs,\n  context: req => new Context(req),\n  resolvers: _.reduce(resolvers, (prev, next) => _.merge(prev, next)),\n  formatError: err => {\n    if (err.message.startsWith(\"Context creation failed: \")) {\n      return new AuthenticationError(\n        err.message.replace(\"Context creation failed: \", \"\")\n      );\n    }\n    return err;\n  },\n  playground: true\n});\n\n// Start accepting connections.\nserver.listen({ port: PORT }).then(({ url }) => {\n  console.log(`🚀 Apollo server running on port ${url}`);\n});\n\nclass Context {\n  constructor(request) {\n    const headers = request.req\n      ? request.req.headers\n      : request.connection.context;\n    this.email = headers && headers.email;\n    this.request = request.req;\n    const strippedEmail = this.validate(headers).replace(/[.\\#\\$]/g, \"--\");\n    this.ref = strippedEmail !== \"\" ? db.ref(strippedEmail) : null;\n  }\n\n  validate(headers) {\n    if (!headers || !headers.email) {\n      return \"\";\n    }\n    var re = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n    if (!re.test(String(headers.email).toLowerCase())) {\n      return \"\";\n    }\n    return headers.email;\n  }\n}\n","import admin from \"firebase-admin\";\nimport settings from \"../../settings.json\";\nimport \"firebase/database\";\nimport firebase from \"firebase\";\n\nfirebase.initializeApp(settings.firebase);\n\nexport default firebase.database();\n","module.exports = require(\"apollo-server\");","module.exports = require(\"babel-runtime/core-js/object/keys\");","module.exports = require(\"babel-runtime/core-js/promise\");","module.exports = require(\"babel-runtime/helpers/asyncToGenerator\");","module.exports = require(\"babel-runtime/helpers/classCallCheck\");","module.exports = require(\"babel-runtime/helpers/createClass\");","module.exports = require(\"babel-runtime/helpers/extends\");","module.exports = require(\"babel-runtime/regenerator\");","module.exports = require(\"firebase\");","module.exports = require(\"firebase-admin\");","module.exports = require(\"firebase/database\");","module.exports = require(\"graphql-import\");","module.exports = require(\"lodash\");"],"sourceRoot":""}