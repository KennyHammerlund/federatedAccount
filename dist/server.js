!function(e){var r={};function n(t){if(r[t])return r[t].exports;var a=r[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=r,n.d=function(e,r,t){n.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,r){if(1&r&&(e=n(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(n.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var a in e)n.d(t,a,function(r){return e[r]}.bind(null,a));return t},n.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(r,"a",r),r},n.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},n.p="/",n(n.s=14)}([function(e,r){e.exports=require("babel-runtime/regenerator")},function(e,r){e.exports=require("babel-runtime/helpers/asyncToGenerator")},function(e,r){e.exports=require("apollo-server")},function(e,r){e.exports=require("babel-runtime/core-js/object/keys")},function(e,r){e.exports=require("babel-runtime/helpers/extends")},function(e,r){e.exports=require("lodash")},function(e,r){e.exports=require("firebase")},function(e,r){e.exports=require("babel-runtime/helpers/classCallCheck")},function(e,r){e.exports=require("babel-runtime/helpers/createClass")},function(e,r){e.exports=require("graphql-import")},function(e){e.exports=JSON.parse('{"firebase":{"apiKey":"AIzaSyAKpZBvjSfci152yGOKOJo-cJvMcnV7-bk","authDomain":"summit-example.firebaseapp.com","databaseURL":"https://summit-example.firebaseio.com","projectId":"summit-example","storageBucket":"summit-example.appspot.com"}}')},function(e,r){e.exports=require("babel-runtime/core-js/promise")},function(e,r){e.exports=require("firebase-admin")},function(e,r){e.exports=require("firebase/database")},function(e,r,n){"use strict";n.r(r);var t={};n.r(t),n.d(t,"game",function(){return P}),n.d(t,"application",function(){return _}),n.d(t,"delay",function(){return T});var a=n(7),i=n.n(a),u=n(8),o=n.n(u),c=n(9),s=n(2),l=n(5),p=n.n(l),f=(n(12),n(10)),m=(n(13),n(6)),d=n.n(m);d.a.initializeApp(f.firebase);var v,h,b,x,y,g=d.a.database(),w=n(4),q=n.n(w),k=n(3),j=n.n(k),A=n(0),S=n.n(A),O=n(11),I=n.n(O),E=n(1),M=n.n(E),C=(v=M()(S.a.mark(function e(r,n){var t,a;return S.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.child("delay"),e.next=3,t.once("value").then(function(e){return e.val()});case 3:return a=e.sent,e.abrupt("return",new I.a(function(e,r){setTimeout(function(){return n().then(e).catch(r)},1e3*a)}));case 5:case"end":return e.stop()}},e,void 0)})),function(e,r){return v.apply(this,arguments)}),P={Query:{application:(y=M()(S.a.mark(function e(r,n,t){return n.input,S.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{online:!0});case 1:case"end":return e.stop()}},e,void 0)})),function(e,r,n){return y.apply(this,arguments)}),game:(x=M()(S.a.mark(function e(r,n,t){var a,i,u,o,c=n.id,s=t.ref;return S.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=s.child("games").child(c),e.next=3,a.once("value");case 3:return i=e.sent,u=i.val(),o=j()(u).filter(function(e){return"name"!==e}),e.abrupt("return",{name:u.name,actionIds:o,gameId:c});case 7:case"end":return e.stop()}},e,void 0)})),function(e,r,n){return x.apply(this,arguments)}),games:(b=M()(S.a.mark(function e(r,n,t){var a,i,u,o=t.ref;return S.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=o.child("games"),e.next=3,a.once("value");case 3:if(i=e.sent,u=i.val(),console.log("*--snapVal",u),u){e.next=8;break}return e.abrupt("return",[]);case 8:return e.abrupt("return",j()(u).map(function(e){return q()({id:e},u[e])}));case 9:case"end":return e.stop()}},e,void 0)})),function(e,r,n){return b.apply(this,arguments)})},Game:{actions:function(e,r,n){var t=n.ref;return e.actionIds?t.child("games").child(e.gameId).once("value").then(function(r){var n=r.val();return j()(n).map(function(e){return q()({id:e},n[e])}).filter(function(r){return e.actionIds.includes(r.id)})}):null}},Mutation:{addGameAction:function(e,r,n){var t=r.input,a=n.ref,i=t.value,u=t.type,o=t.gameId,c=t.timeStamp,s=a.child("games").child(o).child("actions");return C(a,M()(S.a.mark(function e(){var r,n;return S.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.push({type:u,value:i,timeStamp:c});case 2:return e.sent,e.next=5,s.once("value");case 5:return r=e.sent,n=r.val(),e.abrupt("return",j()(n).map(function(e){return q()({id:e},n[e])}));case 8:case"end":return e.stop()}},e,void 0)})))},addGame:(h=M()(S.a.mark(function e(r,n,t){var a,i,u,o,c=n.input,l=t.ref;return S.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=l.child("games"),e.next=3,a.once("value");case 3:return i=e.sent,u=i.val(),j()(u).map(function(e){if(u[e].name===c.name)throw console.log("*--match",u[e]),new s.ApolloError("There is already a game with this name","NO_DUPLICATE")}),o=a.push({name:c.name}),e.abrupt("return",C(l,M()(S.a.mark(function e(){return S.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{name:c.name,id:o.key});case 1:case"end":return e.stop()}},e,void 0)}))));case 8:case"end":return e.stop()}},e,void 0)})),function(e,r,n){return h.apply(this,arguments)})}},_={Query:{summitUpload:function(){var e=M()(S.a.mark(function e(r,n,t){n.input;return S.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{online:!0});case 1:case"end":return e.stop()}},e,void 0)}));return function(r,n,t){return e.apply(this,arguments)}}()}},T={Query:{delay:function(e,r,n){return n.ref.child("delay").once("value").then(function(e){return e.val()})}},Mutation:{setDelay:function(e,r,n){var t=r.delay;return n.ref.child("delay").set(t),t}}},G=Object(c.importSchema)("./src/graphs/schema.graphql");new s.ApolloServer({typeDefs:G,context:function(e){return new z(e)},resolvers:p.a.reduce(t,function(e,r){return p.a.merge(e,r)}),formatError:function(e){return console.log("*--err",e),e.message.startsWith("Context creation failed: ")?new s.AuthenticationError(e.message.replace("Context creation failed: ","")):e}}).listen({port:2999}).then(function(e){var r=e.url;console.log("ðŸš€ Apollo server running on port "+r)});var z=function(){function e(r){i()(this,e);var n=r.req?r.req.headers:r.connection.context;this.email=n&&n.email,this.request=r.req,this.validate(n);var t=n.email.replace(/[.\#\$]/g,"--");this.ref=g.ref(t)}return o()(e,[{key:"validate",value:function(e){if(!e||!e.email)throw new s.AuthenticationError("No Email Provided");if(!/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e.email).toLowerCase()))throw new s.AuthenticationError("Email Malformed, must be a valid email")}}]),e}()}]);